{"ts":1350225134772,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var Multiplexer, bindAddress, config, configFile, fs, listenPort, logger, net, redis, server;\n\nfs = require('fs');\nnet = require('net');\nlogger = require('winston');\nMultiplexer = require('./lib/multiplexer');\n\nconfigFile = process.argv[2] || \"config/config.json\";\nlogger.info(\"using \" + configFile + \" as configuration source\");\nconfig = JSON.parse(fs.readFileSync(configFile));\nbindAddress = config.bind_address || \"127.0.0.1\";\nlistenPort = config.listen_port || 6000;\n\nserver = net.createServer(function (socket) {\n    var multiplexer;\n    logger.debug('Client connected. Init Multiplexer for config');\n    multiplexer = new Multiplexer(config);\n    multiplexer.initConnections();\n\n    socket.on('end', function () {\n        logger.debug('Client disconnected');\n        multiplexer.quit();\n    });\n\n    socket.on('data', function (data) {\n        var command, onlymaster;\n        command = data.toString('utf8');\n\n        logger.debug(\"command: \" + command);\n\n        multiplexer.send(command, function (err, res) {\n            logger.info(\"Primary callback triggered with \" + err + \", \" + res);\n            if (err) {\n                logger.error(\"Got error from primary\", err);\n            }\n            if (res) {\n                logger.info(\"Got response from primary\");\n                socket.write(res.toString('utf8'));\n            }\n            if (/quit/i.test(data)) {\n                logger.debug('QUIT command received closing the connection');\n                socket.end();\n            }\n        });\n    });\n});\n\nserver.listen(listenPort, bindAddress);\n\nlogger.info(\"Server started on \" + bindAddress + \":\" + listenPort);"]],"start1":0,"start2":0,"length1":0,"length2":1637}]],"length":1637}
{"contributors":[],"silentsave":false,"ts":1350225145256,"patch":[[{"diffs":[[0,"mand"],[-1,", onlymaster"],[0,";\n  "]],"start1":857,"start2":857,"length1":20,"length2":8}]],"length":1625,"saved":false}
{"ts":1350225160293,"patch":[[{"diffs":[[0,"var "],[-1,"command;\n        "],[0,"comm"]],"start1":850,"start2":850,"length1":25,"length2":8}]],"length":1608,"saved":false}
{"ts":1350225522476,"patch":[[{"diffs":[[0," || "],[-1,"\"127.0.0.1\""],[1,"process.env.IP"],[0,";\nli"]],"start1":413,"start2":413,"length1":19,"length2":22},{"diffs":[[0," || "],[-1,"6000"],[1,"process.env.PORT"],[0,";\n\ns"]],"start1":464,"start2":464,"length1":12,"length2":24}]],"length":1623,"saved":false}
